services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: amazon-recommender:dev
    container_name: amazon-recommender-app
    working_dir: /app
    volumes:
      - ./:/app
    command: tail -f /dev/null
    ports:
      - "5000:5000"
      - "8000:8000"
    environment:
      # --- Python runtime ---
      PYTHONDONTWRITEBYTECODE: 1
      PYTHONUNBUFFERED: 1

      # --- Java (required by PySpark) ---
      JAVA_HOME: /usr/lib/jvm/java-21-openjdk-amd64
      PATH: "/usr/lib/jvm/java-21-openjdk-amd64/bin:/usr/local/bin:/usr/bin:/bin"

      # --- Spark runtime ---
      PYSPARK_PYTHON: python
      PYSPARK_DRIVER_PYTHON: python

      # Optional performance tweaks
      SPARK_DRIVER_MEMORY: 2g
      SPARK_EXECUTOR_MEMORY: 2g

      # Optional: cleaner Spark logs
      PYSPARK_SUBMIT_ARGS: "--conf spark.ui.showConsoleProgress=false pyspark-shell"

    # Optional network placeholder for future DB/cache services
    # networks:
    #   - app-network
